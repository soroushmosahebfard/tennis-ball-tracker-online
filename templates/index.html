<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üéæ Simple JS Tennis-Ball Tracker</title>
  <style>
    body { background: #111; color: #fff; text-align: center; font-family: sans-serif; }
    video, canvas { border: 4px solid #4caf50; margin: 10px; }
    #wrapper { display: flex; justify-content: center; gap: 20px; }
    .feed { display: flex; flex-direction: column; align-items: center; }
    .feed p { margin: 6px 0; }
    #hidden { display: none; }
  </style>
</head>
<body>
  <h1>üîç Live Tennis-Ball Tracker (Pure JS)</h1>
  <div id="wrapper">
    <div class="feed">
      <p>Raw Feed</p>
      <video id="video" width="640" height="480" autoplay muted playsinline></video>
    </div>
    <div class="feed">
      <p>Detected</p>
      <canvas id="output" width="640" height="480"></canvas>
    </div>
  </div>

  <!-- Offscreen canvas to grab frames -->
  <canvas id="hidden" width="640" height="480"></canvas>

  <script>
    const video = document.getElementById('video');
    const hidden = document.getElementById('hidden');
    const output = document.getElementById('output');
    const hctx = hidden.getContext('2d');
    const octx = output.getContext('2d');
    const width = 640, height = 480;

    // 1) Start camera
    if (navigator.mediaDevices?.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => { alert('Camera error: ' + err.message); });
    } else {
      alert('getUserMedia not supported');
    }

    video.addEventListener('play', () => {
      // run detection every frame
      function detect() {
        // draw current frame to hidden canvas
        hctx.drawImage(video, 0, 0, width, height);
        const frame = hctx.getImageData(0, 0, width, height);
        const data = frame.data;

        let xMin = width, xMax = 0, yMin = height, yMax = 0;
        // threshold for tennis-ball greenish-yellow
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i], g = data[i+1], b = data[i+2];
          // simple threshold: green dominant and bright
          if (g > 150 && g > r + 20 && g > b + 20) {
            const idx = i / 4;
            const x = idx % width;
            const y = Math.floor(idx / width);
            if (x < xMin) xMin = x;
            if (x > xMax) xMax = x;
            if (y < yMin) yMin = y;
            if (y > yMax) yMax = y;
          }
        }

        // draw raw frame
        octx.drawImage(video, 0, 0, width, height);

        // if any pixel passed threshold, draw box
        if (xMax > xMin && yMax > yMin) {
          octx.strokeStyle = '#FFFF00';
          octx.lineWidth = 4;
          octx.strokeRect(xMin, yMin, xMax - xMin, yMax - yMin);
        }

        requestAnimationFrame(detect);
      }
      detect();
    });
  </script>
</body>
</html>
